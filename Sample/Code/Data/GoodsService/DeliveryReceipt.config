<?xml version="1.0" encoding="utf-8"?>
<SQLConfig xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <SQLList>
    <SQL SQLKey="Goods.DeliveryReceipt.GetDeliveryReceipt" ConnectionKey="MainRead">
      <Text>
        <![CDATA[
					SELECT
						SysNo,
						SysCode,
						ReceiptCode,
						DeliveryDate,
						DeliveryUserName,
						DeliveryUserPhone,
						DeliveryUserAddress,
						ObsoleteReason,
						LogisticsContactName,
						LogisticsContactPhone,
						ReceiptStatus,
						ReceiveMode,
						Memo,
						UserSignatureUrl,
						ProjectSysNo,
						ProjectName,
						SupplierSysCode,
						SupplierName,
						DeliveryType,
						Source,
						InUserSysNo,
						InUserName,
						InDate,
						EditUserSysNo,
						EditUserName,
						EditDate,
						CommonStatus 
					FROM
						delivery_receipt
          WHERE SysCode = @SysCode
						AND CommonStatus = @CommonStatus;           
				]]>
      </Text>
    </SQL>
    <SQL SQLKey="Goods.DeliveryReceipt.GetDeliveryReceiptWithDetail" ConnectionKey="MainRead">
      <Text>
        <![CDATA[
					SELECT
						SysNo,
						SysCode,
						ReceiptCode,
						DeliveryDate,
						DeliveryUserName,
						DeliveryUserPhone,
						DeliveryUserAddress,
						ObsoleteReason,
						LogisticsContactName,
						LogisticsContactPhone,
						ReceiptStatus,
						ReceiveMode,
						Memo,
						UserSignatureUrl,
						ProjectSysNo,
						ProjectName,
						SupplierSysCode,
						SupplierName,
						DeliveryType,
						Source,
						InUserSysNo,
						InUserName,
						InDate,
						EditUserSysNo,
						EditUserName,
						EditDate,
						CommonStatus 
					FROM
						delivery_receipt
          WHERE 
						SysCode = @DeliveryReceiptSysCode
						AND CommonStatus = @CommonStatus;
            
					SELECT
						SysNo,
						SysCode,
						DeliveryReceiptSysCode,
						Memo,
						PlateNumber,
						`Status`,
						InUserSysNo,
						InUserName,
						InDate,
						EditUserSysNo,
						EditUserName,
						EditDate,
						CommonStatus 
					FROM
						delivery_receipt_cardetail
					WHERE
						DeliveryReceiptSysCode = @DeliveryReceiptSysCode
            AND CommonStatus = @CommonStatus;
            
					SELECT
						drcdp.SysNo,
						drcdp.SysCode,
						drcdp.DeliveryReceiptSysCode,
						drcdp.DeliveryReceiptCarDetailSysCode,
						drcdp.ProductSysCode,
						drcdp.ProductName,
						drcdp.ProductModel,
            drcdp.ProductBrand,
						drcdp.DeliveryQuantity,
						drcdp.DeliveryUnitName,
						drcdp.UsingSite,
						drcdp.LowerThreshold,
						drcdp.UpperThreshold,
						drcdp.UnitRatio,
            drcdp.UnitPrice,
            drcdp.TaxRate,
						drcdp.InUserSysNo,
						drcdp.InUserName,
						drcdp.InDate,
						drcdp.EditUserSysNo,
						drcdp.EditUserName,
						drcdp.EditDate,
						drcdp.CommonStatus,
            gp.ProductCode
					FROM
						delivery_receipt_cardetail_product drcdp
            LEFT JOIN goods_product gp ON drcdp.ProductSysCode = gp.SysCode
					WHERE
						drcdp.DeliveryReceiptSysCode = @DeliveryReceiptSysCode
            AND drcdp.CommonStatus = @CommonStatus;
				]]>
      </Text>
    </SQL>
		
		<SQL SQLKey="Goods.DeliveryReceipt.GetDeliveryReceipts" ConnectionKey="MainRead">
      <Text>
        <![CDATA[
					SELECT
					  dr.SysNo,
						dr.SysCode,
						dr.ReceiptCode,
						dr.DeliveryDate,
						dr.DeliveryUserName,
						dr.DeliveryUserPhone,
						dr.DeliveryUserAddress,
						dr.ObsoleteReason,
						dr.LogisticsContactName,
						dr.LogisticsContactPhone,
						dr.ReceiptStatus,
						dr.ReceiveMode,
						dr.Memo,
						dr.UserSignatureUrl,
						dr.ProjectSysNo,
						dr.ProjectName,
						dr.SupplierSysCode,
						dr.SupplierName,
						dr.DeliveryType,
						dr.Source,
						dr.CommonStatus
					FROM 
						yz_ers.delivery_receipt dr
					WHERE
						dr.CommonStatus != -999
						#{ AND dr.CommonStatus = @CommonStatus }
						#{ AND dr.SupplierSysCode = @SupplierSysCode }
						#{ AND (dr.ReceiptCode LIKE CONCAT('%',@Keywords,'%')
						   OR dr.SupplierName LIKE CONCAT('%',@Keywords,'%')
							 OR (SELECT COUNT(1) FROM yz_ers.delivery_receipt_cardetail drcd 
							    WHERE drcd.DeliveryReceiptSysCode=dr.SysCode 
									AND drcd.PlateNumber LIKE CONCAT('%',@Keywords,'%'))>0)}
						#{ AND dr.ReceiveMode = @ReceiveMode }
						#{ AND dr.ReceiptStatus in (@Statuses) }
					ORDER BY
						dr.DeliveryDate DESC
				]]>
      </Text>
    </SQL>
		
	  <SQL SQLKey="Goods.DeliveryReceipt.GetDelivery_Cardetail" ConnectionKey="MainRead">
      <Text>
        <![CDATA[
          SELECT
						drcd.SysNo,
						drcd.SysCode,
						drcd.DeliveryReceiptSysCode,
						drcd.Memo,
						drcd.PlateNumber,
						drcd.`Status`,
						drcd.CommonStatus 
					FROM
						yz_ers.delivery_receipt_cardetail drcd
					WHERE drcd.CommonStatus = 1
					AND drcd.DeliveryReceiptSysCode in (@SysCodeList)
				]]>
      </Text>
    </SQL>
		
		<SQL SQLKey="Goods.DeliveryReceipt.GetDelivery_Cardetail_Product" ConnectionKey="MainRead">
      <Text>
        <![CDATA[
          SELECT
						drcdp.SysNo,
						drcdp.SysCode,
						drcdp.DeliveryReceiptSysCode,
						drcdp.DeliveryReceiptCarDetailSysCode,
						drcdp.ProductSysCode,
						drcdp.ProductName,
						drcdp.ProductModel,
						drcdp.DeliveryQuantity,
						drcdp.DeliveryUnitName,
						drcdp.UsingSite,
						drcdp.LowerThreshold,
						drcdp.UpperThreshold,
						drcdp.UnitRatio,
            drcdp.UnitPrice,
            drcdp.TaxRate,
						drcdp.CommonStatus 
					FROM
						yz_ers.delivery_receipt_cardetail_product drcdp
          WHERE drcdp.CommonStatus = 1
					AND drcdp.DeliveryReceiptSysCode in (@SysCodeList)
				]]>
      </Text>
    </SQL>
		
    <SQL SQLKey="Goods.DeliveryReceipt.InsertDeliveryReceipt" ConnectionKey="MainWrite">
      <Text>
        <![CDATA[
					INSERT INTO delivery_receipt (
						SysCode,
						ReceiptCode,
						DeliveryDate,
						DeliveryUserName,
						DeliveryUserPhone,
						DeliveryUserAddress,
						ObsoleteReason,
						LogisticsContactName,
						LogisticsContactPhone,
						ReceiptStatus,
						ReceiveMode,
						Memo,
						UserSignatureUrl,
						ProjectSysNo,
						ProjectName,
						SupplierSysCode,
						SupplierName,
						DeliveryType,
						Source,
						InUserSysNo,
						InUserName,
						InDate,
						EditUserSysNo,
						EditUserName,
						EditDate,
						CommonStatus 
					)
					VALUES
					(
						@SysCode,
						@ReceiptCode,
						@DeliveryDate,
						@DeliveryUserName,
						@DeliveryUserPhone,
						@DeliveryUserAddress,
						@ObsoleteReason,
						@LogisticsContactName,
						@LogisticsContactPhone,
						@ReceiptStatus,
						@ReceiveMode,
						@Memo,
						@UserSignatureUrl,
						@ProjectSysNo,
						@ProjectName,
						@SupplierSysCode,
						@SupplierName,
						@DeliveryType,
						@Source,
						@InUserSysNo,
						@InUserName,
						NOW( 3 ),
						@EditUserSysNo,
						@EditUserName,
						NOW( 3 ),
						@CommonStatus 
					)        
				]]>
      </Text>
    </SQL>
    <SQL SQLKey="Goods.DeliveryReceipt.InsertDeliveryReceiptCarDetail" ConnectionKey="MainWrite">
      <Text>
        <![CDATA[
					INSERT INTO delivery_receipt_cardetail (
						SysCode,
						DeliveryReceiptSysCode,
						Memo,
						PlateNumber,
						`Status`,
						InUserSysNo,
						InUserName,
						InDate,
						EditUserSysNo,
						EditUserName,
						EditDate,
						CommonStatus 
					)
					VALUES
					(
						@SysCode,
						@DeliveryReceiptSysCode,
						@Memo,
						@PlateNumber,
						@Status,
						@InUserSysNo,
						@InUserName,
						NOW(3),
						@EditUserSysNo,
						@EditUserName,
						NOW(3),
						@CommonStatus
					)
				]]>
      </Text>
    </SQL>
    <SQL SQLKey="Goods.DeliveryReceipt.BatchInsertDeliveryReceiptCarDetailProducts" ConnectionKey="MainWrite">
      <Text>
        <![CDATA[
					$BATCHINSERT${[
						INSERT INTO delivery_receipt_cardetail_product (
							SysCode,
							DeliveryReceiptSysCode,
							DeliveryReceiptCarDetailSysCode,
							ProductSysCode,
							ProductName,
							ProductModel,
              ProductBrand,
							DeliveryQuantity,
							DeliveryUnitName,
							UsingSite,
							LowerThreshold,
							UpperThreshold,
							UnitRatio,
              UnitPrice,
							TaxRate,
							InUserSysNo,
							InUserName,
							InDate,
							EditUserSysNo,
							EditUserName,
							EditDate,
							CommonStatus 
						)
						VALUES
						(
							@SysCode,
							@DeliveryReceiptSysCode,
							@DeliveryReceiptCarDetailSysCode,
							@ProductSysCode,
							@ProductName,
							@ProductModel,
              @ProductBrand,
							@DeliveryQuantity,
							@DeliveryUnitName,
							@UsingSite,
							@LowerThreshold,
							@UpperThreshold,
							@UnitRatio,
              @UnitPrice,
							@TaxRate,
							@InUserSysNo,
							@InUserName,
							NOW(3),
							@EditUserSysNo,
							@EditUserName,
							NOW(3),
							@CommonStatus
						)
					]}
				]]>
      </Text>
    </SQL>

    <SQL SQLKey="Goods.DeliveryReceipt.UpdateDeliveryReceipt" ConnectionKey="MainWrite">
      <Text>
        <![CDATA[
        UPDATE delivery_receipt
				SET ReceiptCode = @ReceiptCode,
						DeliveryDate = @DeliveryDate,
						DeliveryUserName = @DeliveryUserName,
						DeliveryUserPhone = @DeliveryUserPhone,
						DeliveryUserAddress = @DeliveryUserAddress,
						ObsoleteReason = @ObsoleteReason,
						LogisticsContactName = @LogisticsContactName,
						LogisticsContactPhone = @LogisticsContactPhone,
						ReceiptStatus = @ReceiptStatus,
						ReceiveMode = @ReceiveMode,
						Memo = @Memo,
						UserSignatureUrl = @UserSignatureUrl,
						ProjectSysNo = @ProjectSysNo,
						ProjectName = @ProjectName,
						SupplierSysCode = @SupplierSysCode,
						SupplierName = @SupplierName,
						DeliveryType = @DeliveryType,
						Source = @Source,
						EditUserSysNo = @EditUserSysNo,
						EditUserName = @EditUserName,
						EditDate = NOW(3),
						CommonStatus = @CommonStatus
				WHERE SysCode = @SysCode
				]]>
      </Text>
    </SQL>
    <SQL SQLKey="Goods.DeliveryReceipt.UpdateDeliveryReceiptStatusWithDetail" ConnectionKey="MainWrite">
      <Text>
        <![CDATA[
        UPDATE delivery_receipt
				SET ReceiptStatus = @ReceiptStatus,						
						EditUserSysNo = @UserSysNo,
						EditUserName = @UserName,
						EditDate = NOW(3)
				WHERE SysCode = @SysCode;
        
        UPDATE delivery_receipt_cardetail
        SET Status = @CarDetailStatus,
						EditUserSysNo = @UserSysNo,
						EditUserName = @UserName,
						EditDate = NOW(3)
        WHERE DeliveryReceiptSysCode = @SysCode AND CommonStatus = 1;
				]]>
      </Text>
    </SQL>
    <SQL SQLKey="Goods.DeliveryReceipt.ObsoleteDeliveryReceipt" ConnectionKey="MainWrite">
      <Text>
        <![CDATA[
        UPDATE delivery_receipt
				SET ReceiptStatus = @ReceiptStatus,	
						ObsoleteReason = @ObsoleteReason,
						EditUserSysNo = @UserSysNo,
						EditUserName = @UserName,
						EditDate = NOW(3)
				WHERE SysCode = @SysCode;
        
        UPDATE delivery_receipt_cardetail
        SET Status = @CarDetailStatus,
						EditUserSysNo = @UserSysNo,
						EditUserName = @UserName,
						EditDate = NOW(3)
        WHERE DeliveryReceiptSysCode = @SysCode AND CommonStatus = 1;
				]]>
      </Text>
    </SQL>

    <SQL SQLKey="Goods.DeliveryReceipt.DeleteDeliveryReceiptCarDetailProducts" ConnectionKey="MainWrite">
      <Text>
        <![CDATA[
        DELETE FROM delivery_receipt_cardetail_product
				WHERE DeliveryReceiptSysCode = @DeliveryReceiptSysCode
				]]>
      </Text>
    </SQL>
  </SQLList>
</SQLConfig>
