<?xml version="1.0" encoding="utf-8"?>
<SQLConfig xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
	<SQLList>
		<!-- 新增用户 -->
		<SQL SQLKey="systeUser.Insert" ConnectionKey="MainWrite">
			<Text>
				<![CDATA[
				
				INSERT INTO `system_user` (
					`SysCode`,
					`LoginName`,
					`LoginPassword`,
					`UserFullName`,
					`Gender`,
					`ContactPhone`,
					`ContactEmail`,
					`AvatarImageUrl`,
					`UserType`,
					`InUserSysNo`,
					`InUserName`,
					`InDate`,
					`EditUserSysNo`,
					`EditUserName`,
					`EditDate`,
					`Memo` 
				)
				VALUES
					(
						@SysCode,
						@LoginName,
						@LoginPassword,
						@UserFullName,
						@Gender,
						@ContactPhone,
						@ContactEmail,
						@AvatarImageUrl,
						@UserType,
						@InUserSysNo,
						@InUserName,
						NOW(3),
						@EditUserSysNo,
						@EditUserName,
						NOW(3),
						@Memo
					);

				SELECT @@IDENTITY;
				]]>
			</Text>
		</SQL>

		<!-- 更新用户 -->
		<SQL SQLKey="systeUser.update" ConnectionKey="MainWrite">
			<Text>
				<![CDATA[
				UPDATE 
					`system_user`
				SET
					UserFullName=@UserFullName,
					Gender=@Gender,
					ContactPhone=@ContactPhone,
					AvatarImageUrl=@AvatarImageUrl,
					ContactPhone=@ContactPhone,
					EditUserSysNo=@EditUserSysNo,
					EditUserName=@EditUserName,
					EditDate=NOW(3),
					Memo=@Memo
				Where SysCode=@SysCode;
				
				UPDATE 
					`organization_user`
				SET
					OrganizationSysCode=@OrganizationSysCode,
					EditUserSysNo=@EditUserSysNo,
					EditUserName=@EditUserName,
					EditDate=NOW(3)
				Where UserSysCode=@SysCode AND OrganizationSysCode!=@OrganizationSysCode;
				]]>
			</Text>
		</SQL>

		<!-- 用户登录后,更新登录次数及IP信息-->
		<SQL SQLKey="systeUser.updateLoginInfo" ConnectionKey="MainWrite">
			<Text>
				<![CDATA[
				UPDATE 
					`system_user`
				SET
					LoginTimes=LoginTimes+1,
					LastLoginIP=@LastLoginIP,
					LastLoginTime=@LastLoginTime,
					EditUserSysNo=@EditUserSysNo,
					EditUserName=@EditUserName,
					EditDate=NOW(3)
				Where SysCode=@SysCode
				]]>
			</Text>
		</SQL>

		<!-- 启用，禁用账号-->
		<SQL SQLKey="systeUser.switchStatus" ConnectionKey="MainWrite">
			<Text>
				<![CDATA[
				UPDATE 
					`system_user` 
				SET
					EditUserSysNo=@EditUserSysNo,
					EditUserName=@EditUserName,
					EditDate=NOW(3),
					CommonStatus = @CommonStatus
				Where SysCode=@SysCode AND CommonStatus != -999;
				]]>
			</Text>
		</SQL>

		<!-- 根据syscode查询用户-->
		<SQL SQLKey="systeUser.GetUserBySysCode" ConnectionKey="MainRead">
			<Text>
				<![CDATA[
				SELECT
					s.SysNo,
					s.SysCode,
					s.LoginName,
					s.UserFullName,
					s.Gender,
					s.ContactPhone,
					s.ContactEmail,
					s.AvatarImageUrl,
					s.LastLoginTime,
					s.LastChangePasswordDate,
					s.LoginTimes,
					s.UserType,
					s.Memo,
					s.CommonStatus 
				FROM
					`system_user` s
				WHERE
					s.CommonStatus != -999 
					AND s.SysCode = @SysCode
				LIMIT 1
				]]>
			</Text>
		</SQL>
		
		<!-- 验证账号密码-->
		<SQL SQLKey="systeUser.GetUserByLoginNameAndPwd" ConnectionKey="MainRead">
			<Text>
				<![CDATA[
				SELECT
					s.SysNo,
					s.SysCode,
					s.LoginName,
					s.UserFullName,
					s.Gender,
					s.ContactPhone,
					s.ContactEmail,
					s.AvatarImageUrl,
					s.LastLoginTime,
					s.LoginTimes,
					s.UserType,
					s.LastLoginIP,
					s.IsInitPassword,
					s.CommonStatus
				FROM
					`system_user` s
				WHERE
					s.CommonStatus != - 999 
					AND s.LoginName = @loginName
					AND s.LoginPassword = @md5Pass
				LIMIT 1
				]]>
			</Text>
		</SQL>
		
		<!-- 旧密码是否正确 (修改密码)-->
		<SQL SQLKey="systeUser.CheckOldPassword" ConnectionKey="MainRead">
			<Text>
				<![CDATA[
				SELECT
					count(1)
				FROM
					`system_user` s
				WHERE
					s.CommonStatus != - 999 
					AND s.SysCode = @SysCode
					AND s.LoginPassword = @LoginPassword
				LIMIT 1
				]]>
			</Text>
		</SQL>

		

		<!-- 检测登录名是否存在-->
		<SQL SQLKey="systeUser.checkLoginNameIsExits" ConnectionKey="MainRead">
			<Text>
				<![CDATA[
				SELECT
				  COUNT(1)
				FROM
					system_user s
				WHERE
					s.CommonStatus != -999
					AND s.LoginName = @LoginName
					#{ AND s.SysCode != @SysCode }
				]]>
			</Text>
		</SQL>

		<!-- 更新用户密码-->
		<SQL SQLKey="systeUser.updateUserPassword" ConnectionKey="MainWrite">
			<Text>
				<![CDATA[
				UPDATE 
					`system_user` 
				SET
					EditUserSysNo=@EditUserSysNo,
					EditUserName=@EditUserName,
					EditDate=NOW(3),
					LastChangePasswordDate=NOW(3),
					LoginPassword=@LoginPassword,
					IsInitPassword=@IsInitPassword
				Where SysCode=@SysCode AND CommonStatus!= -999;
				]]>
			</Text>
		</SQL>

		

		


		
		
		 
	</SQLList>
</SQLConfig>